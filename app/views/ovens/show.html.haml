%h3= @oven.name

.cookie-info
  Cookie in oven:
  - if @oven.cookie
    1 cookie with #{@oven.cookie.fillings || "no fillings"}
    - if @oven.cookie.ready?
      #cookie-status-text
        %h6 Your Cookie is Ready
    - else
      #cookie-status-text
        %h6 Baking your cookie... please wait.
    #cookie-status-button
      = button_to "Retrieve Cookie", empty_oven_path, class: 'button tiny'
  - else
    None

%br

= link_to "Prepare Cookie", new_oven_cookies_path(@oven), class: 'button'

- if @oven.cookie && !@oven.cookie.ready?
  :javascript
    $("#cookie-status-button").hide();
    const TIMEOUT_IN_SECONDS = 1000;
    const cookieStatusChecker = {
      interval: '',
      run: function () {
        interval = setInterval(
          this.checkCookieStatus,
          TIMEOUT_IN_SECONDS
        )
      },
      checkCookieStatus: function() {
        fetch('/api/cookies/#{@oven.cookie.id}/status')
        .then(response => response.json())
        .then(data => {
          if (data.status == "baked") {
            clearInterval(interval)
            $("#cookie-status-text").html('<h6>Your Cookie is Ready</h6>')
            $("#cookie-status-button").show()
          }
        })
        .catch((error) => { clearInterval(interval) }
        )
      }
    }
    cookieStatusChecker.run()